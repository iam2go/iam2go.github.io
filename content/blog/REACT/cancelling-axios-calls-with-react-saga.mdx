---
title: Redux-sagaë¥¼ í†µí•´ axios í˜¸ì¶œ ì·¨ì†Œí•˜ê¸°
date: "2022-12-22"
tags: [react, redux-saga]
description:  Redux-sagaë¥¼ ì‚¬ìš©í•˜ì—¬ axios í˜¸ì¶œì„ ì·¨ì†Œí•˜ëŠ” ë°©ë²•
thumbnail: "./images/redux-saga.png"
---
 <img
    src="https://blog.kakaocdn.net/dn/PvW0j/btrSaq61PiV/axgFtGDb5UnGdzTJCqVyH1/img.gif"
    width="500"
    className="m-auto"
  />

<br/>
<br/>
íšŒì‚¬ í”„ë¡œì íŠ¸ì—ì„œ íŠ¹ì • ìˆ˜ì¹˜ë¥¼ ì¡°íšŒí•˜ê¸° ìœ„í•´ ì‚¬ìš©í•˜ëŠ” APIê°€ ìˆë‹¤. ì´ APIëŠ” ìƒí™©ì— ë”°ë¼ì„œ í˜¸ì¶œ ì‹œê°„ì´ ì˜¤ë˜ ê±¸ë¦¬ê³ , ì¡°íšŒ í•­ëª©ì´ ë§ì•„ì§ˆìˆ˜ë¡ í˜¸ì¶œ ì‹œê°„ì´ ê¸¸ì–´ì§„ë‹¤. ë§Œì•½ ì‚¬ìš©ìê°€ ìˆ˜ì¹˜ë¥¼ ì¡°íšŒí•˜ëŠ” ì¤‘ í™”ë©´ì„ ë‚˜ê°„ë‹¤ë©´, ìˆ˜ì¹˜ ì¡°íšŒ APIëŠ” ì—¬ì „íˆ Pending ì¤‘ì´ê¸° ë•Œë¬¸ì— ê·¸ ì˜í–¥ìœ¼ë¡œ ìƒˆë¡œ ë Œë”ë§ ë˜ëŠ” í™”ë©´ì˜ ë¡œë”©ì´ ê¸¸ì–´ì§€ê²Œ ëœë‹¤.

ìˆ˜ì¹˜ ì¡°íšŒ **APIì˜ ì‘ë‹µì„ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘ í˜„ì¬ í˜ì´ì§€ê°€ unmountëœë‹¤ë©´, í•´ë‹¹ API í˜¸ì¶œì„ ì·¨ì†Œí•˜ì—¬ ë¶ˆí•„ìš”í•œ ë°ì´í„° í˜¸ì¶œì„ ë§‰ê³ , UXë¥¼ ê°œì„ í•˜ë ¤ í•œë‹¤.**

<br/>

í˜„ì¬ í”„ë¡œì íŠ¸ì—ì„œ ë¹„ë™ê¸° í†µì‹  ë¼ì´ë¸ŒëŸ¬ë¦¬ëŠ” `axios` ì‚¬ìš©, ë¹„ë™ê¸° ë¡œì§ì€ `redux-saga` ë¡œ ê´€ë¦¬ ì¤‘ì´ë‹¤. ë”°ë¼ì„œ ì´ ê¸€ì—ì„œëŠ” ì´ ë‘ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ì—¬ API í˜¸ì¶œì„ ì·¨ì†Œí•˜ëŠ” ë°©ë²•ì„ ë‹¤ë£¬ë‹¤.

<br/>
<br/>
# Axiosì˜ ì·¨ì†Œ í† í°

[ì°¸ê³ ](https://axios-http.com/kr/docs/cancellation)

axiosì—ì„œëŠ” `CancelToken.source` ì„ ì‚¬ìš©í•˜ì—¬ ì·¨ì†Œ í† í°ì„ ë§Œë“¤ ìˆ˜ ìˆë‹¤.

```
const cancelSource = axios.CancelToken.source();
```

```
// GETë°©ì‹
axios.get('/user/12345', {
  cancelToken: cancelSource.token
})

// POSTë°©ì‹
axios.post('/user/12345', {
  ...params
}, {
  cancelToken: cancelSource.token
})
```

ë§Œë“  ì·¨ì†Œ í† í°ì„ axios ìš”ì²­ì— ì˜µì…˜ìœ¼ë¡œ ë„£ì–´ì£¼ê³ 

```
cancelSource.cancel();
```

`cancel` ë©”ì„œë“œ í˜¸ì¶œë¡œ í•´ë‹¹ ìš”ì²­ì„ ì·¨ì†Œì‹œí‚¤ëŠ” ë°©ì‹ì´ë‹¤.

â—ï¸ê°™ì€ ì·¨ì†Œ í† í°ìœ¼ë¡œ ì—¬ëŸ¬ ìš”ì²­ì„ ì·¨ì†Œí•  ìˆ˜ë„ ìˆë‹¤.

<br/>

ë§Œì•½ API í˜¸ì¶œ ë¡œì§ì´ ì»´í¬ë„ŒíŠ¸ ë‚´ë¶€ì— ìˆì—ˆë‹¤ë©´, `useEffect` ì•ˆì—ì„œ ì·¨ì†Œ í† í°ì„ ìƒì„±í•œ ë’¤, API í˜¸ì¶œ ì‹œ í•´ë‹¹ í† í°ì„ ë„£ê³ , clean up í•¨ìˆ˜ ë‚´ì—ì„œ `cancel()`ì„ ì‹¤í–‰ì‹œí‚¤ë©´ ëœë‹¤.

```
useEffect(() => {
    const cancelSource = axios.CancelToken.source();
    const fetch = async() => {
        apií˜¸ì¶œ ~~
    }

    fetch();
    return () => {
        cancelSource.cancel();
    }
},[])
```

ëŒ€ì¶© ì´ëŸ° ì‹ìœ¼ë¡œ?

í•˜ì§€ë§Œ ë¹„ë™ê¸° í˜¸ì¶œì„ sagaì—ì„œ í•œë‹¤ë©´ ì € ë¡œì§ì„ ì–´ë–»ê²Œ ë³€í˜•ì‹œì¼œì•¼ í• ê¹Œ?

<br/>
<br/>

# Redux-sagaì—ì„œì˜ axios cencel

ëŒ€ëµì ìœ¼ë¡œ ë¡œì§ì„ ê·¸ë ¤ë³¸ë‹¤ë©´,

1.  ì·¨ì†Œ í† í°(`CancelToken`)ì„ ìƒì„±í•œ ë’¤, API í˜¸ì¶œ ì‹œ í•´ë‹¹ í† í°ì„ ë„£ëŠ” ê³¼ì •ì€ saga í•¨ìˆ˜ì—ì„œ ì§„í–‰.
2.  `useEffect`ë¥¼ í†µí•´ í•´ë‹¹ ì»´í¬ë„ŒíŠ¸ê°€ `unmount` ëœë‹¤ë©´ APIí˜¸ì¶œ ì·¨ì†Œ ì•¡ì…˜ì„ ë°œìƒ ì‹œí‚¤ê³ 
3.  sagaëŠ” í•´ë‹¹ ì•¡ì…˜ì„ ëª¨ë‹ˆí„°ë§í•˜ê³  ìˆë‹¤ê°€ ì•¡ì…˜ ë°œìƒì‹œ `cancel()` ì‹¤í–‰í•œë‹¤.

ì˜ ìˆœì„œë¡œ ì§„í–‰ë  ê²ƒì´ë‹¤.


<br/>
<br/>

# ê¸°ì¡´ì˜ saga êµ¬ì„±

```
// saga.js

export const getDataAction = createAction("getDataAction");

function* getDataFlow(action) {
  const { params } = action.payload;

  yield put(getDataRequest());

  try {
    const response = yield call(getData, params);
        yield put(getRequestSuccess(response.data));
    } catch (error) {
        yield put(getRequestFailure(error));
    }
}

function* dataSaga(){
    yield takeLatest(getDataAction, getDataFlow);
}
```

ê¸°ì¡´ì˜ ì‚¬ê°€ êµ¬ì¡°ë¥¼ ê°„ëµí•˜ê²Œ ì¬êµ¬ì„±í•˜ì—¬ ë‚˜íƒ€ëƒˆë‹¤.

`getDataAction` ì´ ë°œìƒí•˜ë©´ `getDataFlow`ê°€ ì‹¤í–‰ëœë‹¤.

`const response = yield call(getData, params)` ì—ì„œ `getData` ëŠ” axiosë¥¼ í˜¸ì¶œ ë©”ì„œë“œë‹¤.

```
// apis.js

export const getData = async(params) => {
    const response = await axios.post('/somethings', params);
    return response.data;
}
```

<br/>
<br/>

# APIí˜¸ì¶œ ì‹œ ì·¨ì†Œ í† í° ë„£ì–´ì£¼ê¸°

ì´ ê¸°ì¡´ ë¡œì§ì— **_1. ì·¨ì†Œ í† í°ì„ ìƒì„±í•œ ë’¤ API í˜¸ì¶œì‹œ í•´ë‹¹ í† í°ì„ ë„£ëŠ” ê³¼ì •ì„_** ì¶”ê°€í•˜ë©´ ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.

```
function* getDataFlow(action) {
  const { params } = action.payload;
  yield put(getDataRequest());

  try {
        const cancelSource = axios.CancelToken,source();

    const response = yield call(getData, params, {cancelToken: cancelSource.token});
        yield put(getRequestSuccess(response.data));
    } catch (error) {
        yield put(getRequestFailure(error));
    }
}
```

<br/>
<br/>
# unmountì‹œ APIì·¨ì†Œ ì•¡ì…˜ ìƒì„±

```
// saga.js

export const getDataAction = createAction("getDataAction");
export const cancelDataAction = createAction("cancelDataAction");

...
```

```
// (APIë¥¼ í˜¸ì¶œí•˜ëŠ”)Component.jsx

...
useEffect(() => () => {
    dispatch(cancelDataAction());
},[])
```

API í˜¸ì¶œ ì·¨ì†Œë¥¼ ìš”ì²­í•  ì•¡ì…˜ ê°ì²´ `cancelDataAction` ì„ ìƒì„±í•œ ë’¤,
ì»´í¬ë„ŒíŠ¸ê°€ `unmount`ì‹œ í•´ë‹¹ ì•¡ì…˜ì´ ë°œìƒí•˜ë„ë¡ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

ì´ì œ ë‹¤ì‹œ `getDataFlow` ë¡œ ëŒì•„ê°€ `cancelDataAction` ì„ ëª¨ë‹ˆí„°ë§í•˜ëŠ” ì½”ë“œë¥¼ ì¶”ê°€í•´ì£¼ì.


<br/>
<br/>
# ì·¨ì†Œ ì•¡ì…˜ ëª¨ë‹ˆí„°ë§ ì¶”ê°€

ì—¬ê¸°ì„œ ìœ ì˜í•´ì•¼ í•  ì ì€ api í˜¸ì¶œì„ ìœ„í•´ ì‚¬ìš©í•œ `call()` ì€ **ë´‰ì‡„ effect**ë¼ëŠ” ì ì´ë‹¤.

ì¼ë‹¨ call effectê°€ í˜¸ì¶œë˜ë©´ ê·¸ ê²°ê³¼ê°€ ë‚˜ì˜¬ ë•Œê¹Œì§€ ë‹¤ìŒìœ¼ë¡œ ë„˜ì–´ê°ˆ ìˆ˜ ì—†ìœ¼ë¯€ë¡œ
ê²°ê³¼ê°€ ë‚˜ì˜¤ê¸° ì „ pending ìƒíƒœì—ì„œëŠ” `cancelDataAction`ì„ ìºì¹˜í•  ìˆ˜ ì—†ë‹¤.

```
const response = yield call(getData, params, {cancelToken: cancelSource.token});
yield take(cancelDataAction); // call effectê°€ ì™„ë£Œë ë•Œê¹Œì§€ ì·¨ì†Œ ì•¡ì…˜ì„ ìºì¹˜í•˜ì§€ ëª»í•œë‹¤.
```

ìš°ë¦¬ëŠ” API í˜¸ì¶œ ì¤‘ `cancelDataAction`ì´ ë°œìƒí•˜ë©´, ê·¸ ì¦‰ì‹œ API í˜¸ì¶œì„ ì·¨ì†Œí•˜ê¸°ë¥¼ ì›í•˜ëŠ”ë°,
ìœ„ì²˜ëŸ¼ êµ¬í˜„í•œë‹¤ë©´ ìš°ë¦¬ê°€ ì›í•˜ëŠ” ê²°ê³¼ë¥¼ ì–»ì„ ìˆ˜ ì—†ë‹¤.

<br/>
ì´ëŸ° ê²½ìš° ì‚¬ìš©í•˜ëŠ” ê²ƒì´ **`race()` Effectì´ë‹¤.**

raceëŠ” ì´ë¦„ ê·¸ëŒ€ë¡œ ì—¬ëŸ¬ ì´í™íŠ¸ë¥¼ ê²½ì£¼ì‹œì¼œ ê°€ì¥ ë¨¼ì € ì™„ë£Œëœ effectë§Œì„ ì‹¤í–‰í•˜ê³  **ê²½ì£¼ì—ì„œ ì§„ ì´í™íŠ¸ë“¤ì„ ìë™ìœ¼ë¡œ ì·¨ì†Œì‹œí‚¨ë‹¤.**

```
const {response, cancel} = yield race({
      response: call(getData, params , {cancelToken: cancelSource.token}),
      cancel: take(cancelCountAction)
    });
```

ì‚¬ìš©ë°©ë²•ì€ ìœ„ì™€ ê°™ë‹¤.

<br/>
ë§Œì•½ call effectê°€ ë¬´ì‚¬íˆ `resolve` ë˜ë©´ responseì— API ì‘ë‹µ ë°ì´í„°ê°€ ë‹´ê¸°ê³ , resolve ë˜ê¸° ì „ì— ì·¨ì†Œ ìš”ì²­ì´ ë“¤ì–´ì˜¤ë©´, cancelì— ì•¡ì…˜ ê°ì²´ê°€ ë‹´ê¸´ë‹¤.

```
if(cancel && cancel.type){
      yield call(cancelSource.cancel);
}else{
      yield put(getDataSuccess(getRequestSuccess(response.data)));
}
```

ì•„ë˜ ì¡°ê±´ë¬¸ì„ ì¶”ê°€í•˜ì—¬ ë§Œì•½ cancelì— ì•¡ì…˜ ê°ì²´ê°€ ë‹´ê²¼ë‹¤ë©´ cancelì„ ì‹¤í–‰í•˜ê³ ,
ì•„ë‹ˆë¼ë©´ í˜¸ì¶œì´ ì„±ê³µí–ˆë‹¤ëŠ” ì•¡ì…˜ì„ ë³´ë‚´ì¤€ë‹¤.

ì´ì œ ì •ìƒì ìœ¼ë¡œ ë™ì‘í•˜ëŠ”ì§€ í™•ì¸í•´ë³´ì.

 <img
    src="https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FeqkPQi%2FbtrSdaWIoAc%2FRgQKFheIP67p6XQc4ulO3k%2Fimg.png"
    width="300"
    className="m-auto"
  />
API í˜¸ì¶œì´ ì™„ë£Œë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ í˜„ì¬ í˜ì´ì§€ë¥¼ ë‚˜ê°€ë©´,
**pending** ìƒíƒœì˜€ë˜ ë°ì´í„°ê°€ **canceled**ë˜ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆë‹¤.



<br/>
<br/>

```
// saga.js

export const getDataAction = createAction("getDataAction");
export const cancelDataAction = createAction("cancelDataAction");

function* getDataFlow(action) {
  const { params } = action.payload;
  yield put(getDataRequest());

  try {
        const cancelSource = axios.CancelToken,source();
        const {response, cancel} = yield race({
              response: call(getData, params , {cancelToken: cancelSource.token}),
              cancel: take(cancelCountAction)
            });

        if(cancel && cancel.type){
              yield call(cancelSource.cancel);
        }else{
              yield put(getDataSuccess(getRequestSuccess(response.data)));
        }
    } catch (error) {
        yield put(getRequestFailure(error));
    }
}

function* dataSaga(){
    yield takeLatest(getDataAction, getDataFlow);
}
```

ì „ì²´ì ì¸ saga ì½”ë“œëŠ” ë‹¤ìŒê³¼ ê°™ë‹¤.



<br/>
<br/>

# ì°¸ê³  ğŸ“Œ

[https://stackoverflow.com/questions/50078589/cancel-of-requests-through-saga](https://stackoverflow.com/questions/50078589/cancel-of-requests-through-saga)

Â [Cancel of requests through saga](https://stackoverflow.com/questions/50078589/cancel-of-requests-through-saga)

[https://redux-saga.js.org/docs/api/#raceeffects](https://redux-saga.js.org/docs/api/#raceeffects)

Â [API Reference | Redux-Saga](https://redux-saga.js.org/docs/api/#raceeffects)